

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Generalized Roy Model &mdash; OSE data science  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Regression Discontinuity Design (RDD)" href="../regression-discontinuity-design/notebook.html" />
    <link rel="prev" title="Regression and matching estimators in causal effects" href="../matching-estimators/notebook.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> OSE data science
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../lectures/index.html">Lectures</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Problem sets</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#potential-outcome-model">Potential outcome model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#matching-estimators">Matching estimators</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#generalized-roy-model">Generalized Roy model</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Generalized Roy Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#TASK-A">TASK A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1)-Data-Cleaning">1) Data Cleaning</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2)-Update-initialization-(**.yml*)-file">2) Update initialization (**.yml*) file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3)-Estimation">3) Estimation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#TASK-B">TASK B</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1)-Simulate-Data-Set-without-Essential-Heterogeneity">1) Simulate Data Set without Essential Heterogeneity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2)-Compute-Conventional-Average-Treatment-Effect-Parameters">2) Compute Conventional Average Treatment Effect Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3)-Plot-Distribution-of-Benefits">3) Plot Distribution of Benefits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4)-Simulate-Data-Set-with-Essential-Heterogeneity">4) Simulate Data Set with Essential Heterogeneity</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5)-Compute-Conventional-Average-Treatment-Effect-Parameters-Again">5) Compute Conventional Average Treatment Effect Parameters Again</a></li>
<li class="toctree-l4"><a class="reference internal" href="#6)-Investigate-Shape-of-MTE">6) Investigate Shape of MTE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#7)-Simulate-a-new-sample-for-the-Monte-Carlo-exploration">7) Simulate a new sample for the Monte Carlo exploration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#8)-Estimation-of-ATEs-for-Increasing-Positive-Selection-into-Treatment">8) Estimation of ATEs for Increasing Positive Selection into Treatment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Estimation-Strategies:">Estimation Strategies:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Randomization">Randomization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Ordinary-Least-Squares">Ordinary Least Squares</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Conventional-Instrumental-Variables">Conventional Instrumental Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grmpy"><em>grmpy</em></a></li>
<li class="toctree-l4"><a class="reference internal" href="#References">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#regression-discontinuity-design">Regression discontinuity design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../handouts/index.html">Handouts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/index.html">Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../datasets/index.html">Data sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../partners/index.html">Partners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../organization/index.html">Organization</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OSE data science</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Problem sets</a> &raquo;</li>
        
      <li>Generalized Roy Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/problem-sets/generalized-roy-model/notebook.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
<p>Download the notebook <a class="reference download external" download="" href="https://nbviewer.jupyter.org/github/HumanCapitalAnalysis/ose-data-science/blob/master/problem-setsgeneralized-roy-modelnotebook.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">here</span></code></a>!
Interactive online version: <a class="reference external" href="https://mybinder.org/v2/gh/HumanCapitalAnalysis/ose-data-science/master?filepath=problem-setsgeneralized-roy-modelnotebook.ipynb"><img alt="binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">grmpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">linearmodels.iv</span> <span class="kn">import</span> <span class="n">IV2SLS</span>

<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">plot_joint_distribution_unobservables</span>
<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">plot_joint_distribution_outcomes</span>
<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">plot_benefits_and_effects</span>
<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">investigate_mte</span>
<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">plot_estimates</span>
<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">plot_effects</span>
<span class="kn">from</span> <span class="nn">sources.auxiliary</span> <span class="kn">import</span> <span class="n">monte_carlo</span>

<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">8</span>
<span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
</div>
<div class="section" id="Generalized-Roy-Model">
<h1>Generalized Roy Model<a class="headerlink" href="#Generalized-Roy-Model" title="Permalink to this headline">¶</a></h1>
<p><em>In this problem set, we are going to make use of the open-source Python package</em><a class="reference external" href="https://github.com/OpenSourceEconomics/grmpy">grmpy</a><em>to gain a practical understanding of the generalized Roy model and the economics behind it. We will employ</em><a class="reference external" href="https://github.com/OpenSourceEconomics/grmpy">grmpy</a><em>for both simulation and estimation purposes and, in particular, estimate marginal treatment effects (MTE). To become familiar with the capabilities
of</em><a class="reference external" href="https://github.com/OpenSourceEconomics/grmpy">grmpy</a><em>, we will explore the relationship between college education and income using a toy data set in Task A. In Task B, we will then conduct a Monte Carlo analysis using our own simulated data. Auxiliary functions for Task B are provided in the file</em><a class="reference external" href="https://github.com/HumanCapitalAnalysis/microeconometrics/blob/master/problem-sets/generalized-roy-model/sources/auxiliary.py">auxiliary.py</a><em>.</em></p>
<div class="section" id="TASK-A">
<h2>TASK A<a class="headerlink" href="#TASK-A" title="Permalink to this headline">¶</a></h2>
<p><em>Suppose we want to estimate the effect of post-secondary education on income. We use a toy model where log earnings (Y) is a function of experience (exp), experience squared (expsq), and mother’s education (momsEdu). The decision to enroll in college (D) is modeled as a function of mother’s education and distance to college (distCol).</em></p>
<p>In this task, you’ll learn how to: - import and export data files in the <em>pickle</em> format - analyze <em>pandas</em> DataFrames - create basic plots with <em>seaborn</em> - use <em>grmpy</em> to estimate and plot <em>Marginal Treatmen Effects</em> (<em>MTE</em>)</p>
<p><strong>Resources</strong>: - Reading <em>pickle</em> files with <em>pandas</em>: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_pickle.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_pickle.html</a></p>
<ul class="simple">
<li><p>Saving <em>pickle</em> files with <em>pandas</em>: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_pickle.html#pandas.DataFrame.to_pickle">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.to_pickle.html#pandas.DataFrame.to_pickle</a></p></li>
<li><p>Plotting with <em>seaborn</em>: <a class="reference external" href="https://seaborn.pydata.org/tutorial/distributions.html">https://seaborn.pydata.org/tutorial/distributions.html</a></p></li>
<li><p>Dealing with NaNs in <em>pandas</em> DataFrames: <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dropna.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dropna.html</a></p></li>
<li><p><em>grmpy</em> Documentation: <a class="reference external" href="https://grmpy.readthedocs.io/en/latest/tutorial.html">https://grmpy.readthedocs.io/en/latest/tutorial.html</a></p></li>
</ul>
</div>
<div class="section" id="1)-Data-Cleaning">
<h2>1) Data Cleaning<a class="headerlink" href="#1)-Data-Cleaning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Import-Raw-Data">
<h3>Import Raw Data<a class="headerlink" href="#Import-Raw-Data" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>variable</p></th>
<th class="head"><p>meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>wage</p></td>
<td><p>logarithm of hourly wages</p></td>
</tr>
<tr class="row-odd"><td><p>enroll</p></td>
<td><p>=1 if attended college</p></td>
</tr>
<tr class="row-even"><td><p>exp</p></td>
<td><p>years of labor market experience</p></td>
</tr>
<tr class="row-odd"><td><p>exp2</p></td>
<td><p>labor market experience squared</p></td>
</tr>
<tr class="row-even"><td><p>momsEdu</p></td>
<td><p>mother’s years of schooling</p></td>
</tr>
<tr class="row-odd"><td><p>distCol</p></td>
<td><p>distance to nearest college (in km)</p></td>
</tr>
</tbody>
</table>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;data/education_data_raw.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>enroll</th>
      <th>exp</th>
      <th>exp2</th>
      <th>momsEdu</th>
      <th>distCol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.750761</td>
      <td>1.0</td>
      <td>12.333383</td>
      <td>152.112320</td>
      <td>10.798113</td>
      <td>3.131401</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4.846447</td>
      <td>1.0</td>
      <td>29.095451</td>
      <td>846.545288</td>
      <td>10.066148</td>
      <td>11.846854</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.884425</td>
      <td>1.0</td>
      <td>9.877062</td>
      <td>97.556351</td>
      <td>11.661082</td>
      <td>16.798515</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2.639430</td>
      <td>0.0</td>
      <td>4.523223</td>
      <td>20.459551</td>
      <td>14.799751</td>
      <td>25.666601</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2.303309</td>
      <td>1.0</td>
      <td>17.394547</td>
      <td>302.570251</td>
      <td>13.996597</td>
      <td>36.076962</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Drop-Missing-Values">
<h3>Drop Missing Values<a class="headerlink" href="#Drop-Missing-Values" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-Wage-Distribution">
<h3>Plot Wage Distribution<a class="headerlink" href="#Plot-Wage-Distribution" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;wage&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_15_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_15_0.png" />
</div>
</div>
</div>
<div class="section" id="Detect-and-Delete-Outliers">
<h3>Detect and Delete Outliers<a class="headerlink" href="#Detect-and-Delete-Outliers" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;wage&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>enroll</th>
      <th>exp</th>
      <th>exp2</th>
      <th>momsEdu</th>
      <th>distCol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>100</th>
      <td>-2.0</td>
      <td>0.0</td>
      <td>6.143672</td>
      <td>37.744705</td>
      <td>14.653296</td>
      <td>40.399162</td>
    </tr>
    <tr>
      <th>1307</th>
      <td>-3.0</td>
      <td>0.0</td>
      <td>26.190847</td>
      <td>685.960510</td>
      <td>8.856008</td>
      <td>24.471748</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;wage&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>wage</th>
      <th>enroll</th>
      <th>exp</th>
      <th>exp2</th>
      <th>momsEdu</th>
      <th>distCol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020</th>
      <td>20.0</td>
      <td>0.0</td>
      <td>14.677003</td>
      <td>215.414413</td>
      <td>15.791445</td>
      <td>9.648646</td>
    </tr>
    <tr>
      <th>3750</th>
      <td>20.0</td>
      <td>1.0</td>
      <td>20.448292</td>
      <td>418.132629</td>
      <td>13.125582</td>
      <td>25.551018</td>
    </tr>
    <tr>
      <th>4111</th>
      <td>15.0</td>
      <td>0.0</td>
      <td>37.680630</td>
      <td>1419.829834</td>
      <td>10.269114</td>
      <td>35.957970</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_clean</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">wage</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">wage</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Check if cleaning successful</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data_clean</span><span class="p">[</span><span class="s2">&quot;wage&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_20_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_20_0.png" />
</div>
</div>
</div>
<div class="section" id="Save-Clean-Data-Set-as-New-pkl-File">
<h3>Save Clean Data Set as New <em>pkl</em> File<a class="headerlink" href="#Save-Clean-Data-Set-as-New-pkl-File" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_clean</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">&quot;data/education_data_clean.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2)-Update-initialization-(**.yml*)-file">
<h2>2) Update initialization (<a href="#id1"><span class="problematic" id="id2">**</span></a>.yml*) file<a class="headerlink" href="#2)-Update-initialization-(**.yml*)-file" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to do this: - Open a text editor and type <em>data/education_data_clean.pkl</em> in the blank after <em>ESTIMATION file:</em> Then restart the kernel. - Change the cell below from <em>markdown</em> to <em>code</em> and run it. (I copied and pasted the contents of the original initialization file into the cell below and included the correct file path. Running it will overwrite the initialization file directly. You do not need to restart your kernel.)</p>
<hr class="docutils" />
<p>ESTIMATION: file: data/education_data_clean.pkl dependent: wage indicator: enroll</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># parametric model
output_file: est.grmpy.info
optimizer: SCIPY-BFGS
start: auto
maxiter: 6383
agents: 165
comparison: True
print_output: False

# semiparametric model
show_output: False
logit: True
nbins: 30
rbandwidth: 0.05
bandwidth: 0.3
gridsize: 500
ps_range: [0.005, 0.995]
</pre></div>
</div>
<p>TREATED: order: - exp - exp2 - momsEdu UNTREATED: order: - exp - exp2 - momsEdu CHOICE: order: - momsEdu - distCol DIST: params: - 0.1 - 0.0 - 0.0 - 0.1 - 0.0 - 1.0 SCIPY-BFGS: gtol: 1.0e-05 eps: 1.4901161193847655e-08 SCIPY-POWELL: xtol: 9.147777614048603e-05 ftol: 9.749582129043358e-05</p>
</div>
<div class="section" id="3)-Estimation">
<h2>3) Estimation<a class="headerlink" href="#3)-Estimation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Fit-the-Parametric-Model-and-Plot-the-MTE">
<h3>Fit the Parametric Model and Plot the <em>MTE</em><a class="headerlink" href="#Fit-the-Parametric-Model-and-Plot-the-MTE" title="Permalink to this headline">¶</a></h3>
<p><em>Note</em>: The parametric normal model (semipar=False) is set by default.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rslt_par</span> <span class="o">=</span> <span class="n">grmpy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s2">&quot;sources/education.grmpy.yml&quot;</span><span class="p">,</span> <span class="n">semipar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                              Optimization Results
================================================================================
Dep. Variable:                 wage     Optimizer:                          BFGS
Choice Var:                  enroll     No. Evaluations:                      43
Date:              Wed, 14 Apr 2021     Success:                               1
Time:                      20:15:27     Status:                                0
Observations:                  4848     Message:         Optimization terminated
Start Values:                  auto                                successfully.
                                        Criterion Func:
                                             Start:                      +1.3705
                                             Finish:                     +1.3028
================================================================================
                        coef   std err         t     P&gt;|t|     [0.025     0.975]
--------------------------------------------------------------------------------
TREATED

const                 0.2109     0.077     2.756     0.006      0.061      0.361
exp                   0.1482     0.004    39.030     0.000      0.141      0.156
exp2                 -0.0014     0.000   -14.966     0.000     -0.002     -0.001
momsEdu               0.0821     0.005    16.396     0.000      0.072      0.092

UNTREATED

const                 0.8611     0.064    13.522     0.000      0.736      0.986
exp                   0.1239     0.004    34.399     0.000      0.117      0.131
exp2                 -0.0016     0.000   -17.928     0.000     -0.002     -0.001
momsEdu               0.0487     0.005    10.012     0.000      0.039      0.058

CHOICE

const                 0.0972     0.110     0.885     0.376     -0.118      0.312
momsEdu               0.1083     0.009    12.197     0.000      0.091      0.126
distCol              -0.0556     0.002   -35.748     0.000     -0.059     -0.053

DIST

sigma1                0.5489     0.009    63.894     0.000      0.532      0.566
rho1                 -0.2736     0.052    -5.246     0.000     -0.376     -0.171
sigma0                0.5515     0.010    57.193     0.000      0.533      0.570
rho0                  0.4973     0.040    12.305     0.000      0.418      0.577
================================================================================

Warning:

---

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grmpy</span><span class="o">.</span><span class="n">plot_mte</span><span class="p">(</span><span class="n">rslt_par</span><span class="p">,</span> <span class="s2">&quot;sources/education.grmpy.yml&quot;</span><span class="p">,</span> <span class="n">semipar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_30_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_30_0.png" />
</div>
</div>
</div>
<div class="section" id="Fit-the-Semiparametric-Model-and-Plot-the-MTE">
<h3>Fit the Semiparametric Model and Plot the <em>MTE</em><a class="headerlink" href="#Fit-the-Semiparametric-Model-and-Plot-the-MTE" title="Permalink to this headline">¶</a></h3>
<p><strong>Remarks</strong>: - The standard errors and corresponding confidence intervals for the semiparametric <em>MTE</em> are bootstrapped (as opposed to the parametric <em>MTE</em>, where confidence intervals are computed analytically). Here, when plotting the seimparametric <em>MTE</em>, specifiy 250 bootstrap iterations. - Choose a different color for the semiparmateric <em>MTE</em> than you did in <strong>7)</strong> and save the plot</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rslt_semipar</span> <span class="o">=</span> <span class="n">grmpy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="s2">&quot;sources/education.grmpy.yml&quot;</span><span class="p">,</span> <span class="n">semipar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grmpy</span><span class="o">.</span><span class="n">plot_mte</span><span class="p">(</span>
    <span class="n">rslt_semipar</span><span class="p">,</span>
    <span class="s2">&quot;sources/education.grmpy.yml&quot;</span><span class="p">,</span>
    <span class="n">semipar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">nboot</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
    <span class="n">save_plot</span><span class="o">=</span><span class="s2">&quot;MTE_semipar.png&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_34_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_34_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="TASK-B">
<h2>TASK B<a class="headerlink" href="#TASK-B" title="Permalink to this headline">¶</a></h2>
<p><em>To gain more insights into the economic implications behind grmpy and the realm of marginal treatment effects, you will now perform a simulated Monte Carlo analysis. Sim- ulated data allows us to explore additional objects of interest, for which we are not able to obtain reliable information using empirical data sets. With simulated data, we have information on the whole range of potential outcomes for each individual and can bypass the evaluation problem. Moreover, we can directly construct
conventional treatment effect parameters on the population level (e.g. see chapters 2.3, 2.4, and 3.3 in</em><a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1573441207060709">Heckman &amp; Vytlacil (2007a))</a><em>.</em></p>
<p><em>We will stick with our college example from above. For simplicity, however, assume now that log earnings (Y) only depend on mother’s education (momsEdu), and the enrollment decision is solely driven by distance to college (distCol). To help you along with the analysis, we have prepared some auxiliary functions in</em><a class="reference external" href="https://github.com/HumanCapitalAnalysis/microeconometrics/blob/master/problem-sets/generalized-roy-model/sources/auxiliary.py">auxiliary.py</a><em>.</em></p>
</div>
<div class="section" id="1)-Simulate-Data-Set-without-Essential-Heterogeneity">
<h2>1) Simulate Data Set without Essential Heterogeneity<a class="headerlink" href="#1)-Simulate-Data-Set-without-Essential-Heterogeneity" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">grmpy</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="s2">&quot;sources/sim.grmpy.yml&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>const</th>
      <th>momsEdu</th>
      <th>distCol</th>
      <th>U1</th>
      <th>U0</th>
      <th>V</th>
      <th>Y1</th>
      <th>Y0</th>
      <th>D</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.225034</td>
      <td>1.012175</td>
      <td>0.052736</td>
      <td>0.036747</td>
      <td>0.410380</td>
      <td>0.927842</td>
      <td>0.480489</td>
      <td>0.0</td>
      <td>0.480489</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.405429</td>
      <td>0.016576</td>
      <td>0.167313</td>
      <td>0.084724</td>
      <td>-1.789534</td>
      <td>0.942300</td>
      <td>0.483366</td>
      <td>1.0</td>
      <td>0.942300</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.590194</td>
      <td>-0.010326</td>
      <td>0.077226</td>
      <td>0.009501</td>
      <td>-1.420377</td>
      <td>0.749669</td>
      <td>0.361952</td>
      <td>1.0</td>
      <td>0.749669</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>-0.036321</td>
      <td>-0.196745</td>
      <td>-0.013412</td>
      <td>-0.025191</td>
      <td>0.052811</td>
      <td>0.966430</td>
      <td>0.465729</td>
      <td>1.0</td>
      <td>0.966430</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.049373</td>
      <td>-0.534595</td>
      <td>0.053207</td>
      <td>-0.278110</td>
      <td>-0.043756</td>
      <td>1.080609</td>
      <td>0.234233</td>
      <td>1.0</td>
      <td>1.080609</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Joint distribution of potential outcomes</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_joint_distribution_outcomes</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_40_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_40_0.png" />
</div>
</div>
</div>
<div class="section" id="2)-Compute-Conventional-Average-Treatment-Effect-Parameters">
<h2>2) Compute Conventional Average Treatment Effect Parameters<a class="headerlink" href="#2)-Compute-Conventional-Average-Treatment-Effect-Parameters" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">treated</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">untreated</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

<span class="n">ATE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y0&quot;</span><span class="p">])</span>
<span class="n">TT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">treated</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">treated</span><span class="p">])</span>
<span class="n">TUT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">untreated</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">untreated</span><span class="p">])</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;ATE: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">TT:  </span><span class="si">{}</span><span class="se">\n</span><span class="s2">TUT: </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">TT</span><span class="p">,</span> <span class="n">TUT</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ATE: 0.49837010112785857
TT:  0.4954024417207537
TUT: 0.5035665666371357

</pre></div></div>
</div>
</div>
<div class="section" id="3)-Plot-Distribution-of-Benefits">
<h2>3) Plot Distribution of Benefits<a class="headerlink" href="#3)-Plot-Distribution-of-Benefits" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_benefits_and_effects</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ATE: 0.49837010112785857
TT:  0.4954024417207537
TUT: 0.5035665666371357

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_44_1.png" src="../../_images/problem-sets_generalized-roy-model_notebook_44_1.png" />
</div>
</div>
</div>
<div class="section" id="4)-Simulate-Data-Set-with-Essential-Heterogeneity">
<h2>4) Simulate Data Set with Essential Heterogeneity<a class="headerlink" href="#4)-Simulate-Data-Set-with-Essential-Heterogeneity" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_eh</span> <span class="o">=</span> <span class="n">grmpy</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="s2">&quot;sources/sim-eh.grmpy.yml&quot;</span><span class="p">)</span>
<span class="n">data_eh</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>const</th>
      <th>momsEdu</th>
      <th>distCol</th>
      <th>U1</th>
      <th>U0</th>
      <th>V</th>
      <th>Y1</th>
      <th>Y0</th>
      <th>D</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.225034</td>
      <td>1.012175</td>
      <td>-0.047684</td>
      <td>0.059403</td>
      <td>0.407904</td>
      <td>0.827422</td>
      <td>0.503145</td>
      <td>0.0</td>
      <td>0.503145</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.405429</td>
      <td>0.016576</td>
      <td>-0.000332</td>
      <td>0.091776</td>
      <td>-1.797355</td>
      <td>0.774655</td>
      <td>0.490419</td>
      <td>1.0</td>
      <td>0.774655</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.590194</td>
      <td>-0.010326</td>
      <td>0.019922</td>
      <td>0.002064</td>
      <td>-1.423980</td>
      <td>0.692364</td>
      <td>0.354516</td>
      <td>1.0</td>
      <td>0.692364</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>-0.036321</td>
      <td>-0.196745</td>
      <td>-0.002204</td>
      <td>-0.026339</td>
      <td>0.053439</td>
      <td>0.977638</td>
      <td>0.464581</td>
      <td>1.0</td>
      <td>0.977638</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.049373</td>
      <td>-0.534595</td>
      <td>-0.144077</td>
      <td>-0.241421</td>
      <td>-0.046249</td>
      <td>0.883324</td>
      <td>0.270922</td>
      <td>1.0</td>
      <td>0.883324</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We investigate distribution of the unobservables when essential heterogeneity is absent and present, respectively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_joint_distribution_unobservables</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_48_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_48_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_joint_distribution_unobservables</span><span class="p">(</span><span class="n">data_eh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_49_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_49_0.png" />
</div>
</div>
</div>
<div class="section" id="5)-Compute-Conventional-Average-Treatment-Effect-Parameters-Again">
<h2>5) Compute Conventional Average Treatment Effect Parameters Again<a class="headerlink" href="#5)-Compute-Conventional-Average-Treatment-Effect-Parameters-Again" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">treated</span> <span class="o">=</span> <span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">untreated</span> <span class="o">=</span> <span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

<span class="n">ATE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;Y1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;Y0&quot;</span><span class="p">])</span>
<span class="n">TT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;Y1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">treated</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;Y0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">treated</span><span class="p">])</span>
<span class="n">TUT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;Y1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">untreated</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_eh</span><span class="p">[</span><span class="s2">&quot;Y0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">untreated</span><span class="p">])</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;ATE: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">TT:  </span><span class="si">{}</span><span class="se">\n</span><span class="s2">TUT: </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">TT</span><span class="p">,</span> <span class="n">TUT</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ATE: 0.4991197069001682
TT:  0.5395619748560901
TUT: 0.42821211814925686

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_benefits_and_effects</span><span class="p">(</span><span class="n">data_eh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ATE: 0.4991197069001682
TT:  0.5395619748560901
TUT: 0.42821211814925686

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_52_1.png" src="../../_images/problem-sets_generalized-roy-model_notebook_52_1.png" />
</div>
</div>
</div>
<div class="section" id="6)-Investigate-Shape-of-MTE">
<h2>6) Investigate Shape of MTE<a class="headerlink" href="#6)-Investigate-Shape-of-MTE" title="Permalink to this headline">¶</a></h2>
<p>Let us revisit the shape of the marginal effect of college attendance with and without essential hetergeneity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">investigate_mte</span><span class="p">(</span><span class="s2">&quot;data.grmpy.info&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_55_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_55_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">investigate_mte</span><span class="p">(</span><span class="s2">&quot;data_eh.grmpy.info&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_56_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_56_0.png" />
</div>
</div>
</div>
<div class="section" id="7)-Simulate-a-new-sample-for-the-Monte-Carlo-exploration">
<h2>7) Simulate a new sample for the Monte Carlo exploration<a class="headerlink" href="#7)-Simulate-a-new-sample-for-the-Monte-Carlo-exploration" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_mc</span> <span class="o">=</span> <span class="n">grmpy</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>How do the ATE and TT diverge if we introduce essential heterogeneity?</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">effects</span> <span class="o">=</span> <span class="n">monte_carlo</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;conventional_average_effects&quot;</span><span class="p">)</span>
<span class="n">plot_effects</span><span class="p">(</span><span class="n">effects</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_60_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_60_0.png" />
</div>
</div>
</div>
<div class="section" id="8)-Estimation-of-ATEs-for-Increasing-Positive-Selection-into-Treatment">
<h2>8) Estimation of ATEs for Increasing Positive Selection into Treatment<a class="headerlink" href="#8)-Estimation-of-ATEs-for-Increasing-Positive-Selection-into-Treatment" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="Estimation-Strategies:">
<h2>Estimation Strategies:<a class="headerlink" href="#Estimation-Strategies:" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Randomization</p></li>
<li><p>Ordinary Least Squares</p></li>
<li><p>Conventional Instrumental Variables</p></li>
<li><p>grmpy</p>
<ul>
<li><p>Parametric Normal Model</p></li>
<li><p>Local Instrumental Variables</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="Randomization">
<h2>Randomization<a class="headerlink" href="#Randomization" title="Permalink to this headline">¶</a></h2>
<p>Without essential heterogeneity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">treated</span> <span class="o">=</span> <span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">untreated</span> <span class="o">=</span> <span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

<span class="n">ATE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">treated</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">untreated</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Effect &quot;</span><span class="p">,</span> <span class="n">ATE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Effect  0.4840767869358851
</pre></div></div>
</div>
<p>Introducing essential heterogeneity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">estimate</span> <span class="o">=</span> <span class="n">monte_carlo</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;randomization&quot;</span><span class="p">)</span>
<span class="n">plot_estimates</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_67_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_67_0.png" />
</div>
</div>
</div>
<div class="section" id="Ordinary-Least-Squares">
<h2>Ordinary Least Squares<a class="headerlink" href="#Ordinary-Least-Squares" title="Permalink to this headline">¶</a></h2>
<p>We look at an OLS regression in the baseline sample without essential heterogeneity. The coefficient on the treatment dummy <em>D</em> captures the average treatment effect (ATE).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">OLSresults</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">data_mc</span><span class="p">[[</span><span class="s2">&quot;const&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">OLSresults</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                            OLS Regression Results
==============================================================================
Dep. Variable:                      Y   R-squared:                       0.168
Model:                            OLS   Adj. R-squared:                  0.168
Method:                 Least Squares   F-statistic:                     2025.
Date:                Wed, 14 Apr 2021   Prob (F-statistic):               0.00
Time:                        20:16:30   Log-Likelihood:                -7590.9
No. Observations:               10000   AIC:                         1.519e+04
Df Residuals:                    9998   BIC:                         1.520e+04
Df Model:                           1
Covariance Type:            nonrobust
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.5114      0.009     59.516      0.000       0.495       0.528
D              0.4841      0.011     44.999      0.000       0.463       0.505
==============================================================================
Omnibus:                       86.838   Durbin-Watson:                   2.006
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              139.344
Skew:                          -0.025   Prob(JB):                     5.52e-31
Kurtosis:                       3.576   Cond. No.                         3.08
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div></div>
</div>
<p>Introducing essential heterogeneity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">estimate</span> <span class="o">=</span> <span class="n">monte_carlo</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;ols&quot;</span><span class="p">)</span>
<span class="n">plot_estimates</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_72_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_72_0.png" />
</div>
</div>
</div>
<div class="section" id="Conventional-Instrumental-Variables">
<h2>Conventional Instrumental Variables<a class="headerlink" href="#Conventional-Instrumental-Variables" title="Permalink to this headline">¶</a></h2>
<p>Without essential heterogeneity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">IVresults</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span>
    <span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">],</span> <span class="n">data_mc</span><span class="p">[[</span><span class="s2">&quot;const&quot;</span><span class="p">,</span> <span class="s2">&quot;momsEdu&quot;</span><span class="p">]],</span> <span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="n">data_mc</span><span class="p">[</span><span class="s2">&quot;distCol&quot;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">IVresults</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:                      Y   R-squared:                      0.8060
Estimator:                    IV-2SLS   Adj. R-squared:                 0.8060
No. Observations:               10000   F-statistic:                 2.068e+04
Date:                Wed, Apr 14 2021   P-value (F-stat)                0.0000
Time:                        20:16:34   Distribution:                  chi2(2)
Cov. Estimator:                robust

                             Parameter Estimates
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          0.5070     0.0125     40.501     0.0000      0.4824      0.5315
momsEdu        0.4475     0.0032     142.03     0.0000      0.4413      0.4537
D              0.4901     0.0190     25.832     0.0000      0.4529      0.5273
==============================================================================

Endogenous: D
Instruments: distCol
Robust Covariance (Heteroskedastic)
Debiased: False
</pre></div></div>
</div>
<p>Introducing essential heterogeneity</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">estimate</span> <span class="o">=</span> <span class="n">monte_carlo</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;iv&quot;</span><span class="p">)</span>
<span class="n">plot_estimates</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_77_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_77_0.png" />
</div>
</div>
</div>
<div class="section" id="grmpy">
<h2><em>grmpy</em><a class="headerlink" href="#grmpy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="1)-Parametric-Normal-Model">
<h3>1) Parametric Normal Model<a class="headerlink" href="#1)-Parametric-Normal-Model" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">estimate</span> <span class="o">=</span> <span class="n">monte_carlo</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;grmpy&quot;</span><span class="p">)</span>
<span class="n">plot_estimates</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_80_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_80_0.png" />
</div>
</div>
</div>
<div class="section" id="2)-Local-Instrumental-Variables">
<h3>2) Local Instrumental Variables<a class="headerlink" href="#2)-Local-Instrumental-Variables" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">estimate</span> <span class="o">=</span> <span class="n">monte_carlo</span><span class="p">(</span><span class="s2">&quot;sources/mc.grmpy.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;grmpy-liv&quot;</span><span class="p">)</span>
<span class="n">plot_estimates</span><span class="p">(</span><span class="n">ATE</span><span class="p">,</span> <span class="n">estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/problem-sets_generalized-roy-model_notebook_82_0.png" src="../../_images/problem-sets_generalized-roy-model_notebook_82_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>grmpy (2018). grmpy: <a class="reference external" href="http://doi.org/10.5281/zenodo.1162639">A Python package for the simulation and estimation of the generalized Roy model.</a></p></li>
<li><p>Heckman, J. J., Urzua, S., &amp; Vytlacil, E. J. (2006). <a class="reference external" href="https://www.jstor.org/stable/40043006?seq=1">Understanding instrumental variables in models with essential heterogeneity.</a> <em>Review of Economics and Statistics, 88</em>(3), 389– 432.</p></li>
<li><p>Heckman, J. J., &amp; Vytlacil, E. J. (2007a). <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1573441207060709">Econometric evaluation of social programs, part I: Causal effects, structural models and econometric policy evaluation.</a> In J. J. Heckman &amp; E. E. Leamer (Eds.), <em>Handbook of econometrics (Vol. 6B, pp. 4779–4874)</em>.</p></li>
<li><p>Heckman, J. J., &amp; Vytlacil, E. J. (2007b). <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1573441207060710">Econometric evaluation of social programs, part II: Using the marginal treatment effect to organize alternative economic estimators to evaluate social programs and to forecast their effects in new environments.</a> In J. J. Heckman &amp; E. E. Leamer (Eds.), <em>Handbook of econometrics (Vol. 6B, pp. 4875– 5144)</em>.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../regression-discontinuity-design/notebook.html" class="btn btn-neutral float-right" title="Regression Discontinuity Design (RDD)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../matching-estimators/notebook.html" class="btn btn-neutral float-left" title="Regression and matching estimators in causal effects" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Prof. Dr. Philipp Eisenhauer.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
